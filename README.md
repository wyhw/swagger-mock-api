# Swagger Mock API

[![Build Status](https://travis-ci.org/cdcabrera/swagger-mock-api.svg?branch=master)](https://travis-ci.org/cdcabrera/swagger-mock-api) [![Coverage Status](https://coveralls.io/repos/github/cdcabrera/swagger-mock-api/badge.svg)](https://coveralls.io/github/cdcabrera/swagger-mock-api) [![Conventional Commits](https://img.shields.io/badge/Conventional%20Commits-1.0.0-yellow.svg)](https://conventionalcommits.org)

This module is a connect-compatible middleware generating function that generates an API based on a Swagger 2.0 compatible YAML or JSON file. All data returned is generated by [chance](http://chancejs.com/).

* [mock-api](#)
  * [installation](#)
  * [Using the middleware](#)
    * [Ignoring specific paths](#)
  * [Specifying custom Chance options](#)
  * [A note on types:](#)
    * [Returning Fixed values](#)

## What's been updated?

This module has been updated to focus on serving up a mock API through Docker, while still maintaining most of the original middleware functionality.

These updates were done in prep for a major rewrite. They include:

* Switching to an automated semver release model
* Stripping the code sans-Babel while leaving linting in place
* Converting demo to the application, sans-Grunt, in prep for combining with the base module
* Prep for removing optional custom Swagger spec types, for streamlining
* Expanding unit tests a bit, plus adding coverage

## Installation

All updates are currently not available via NPM, you can chose to use the original install here:

```shell
$ npm install swagger-mock-api
```

If you want to use the updates you'll need to fork/clone this repository, then:

```shell
$ npm install
$ npm start
```

From there the mock API should serve up, along with the Swagger spec documentation.

* http://localhost:8000/api/v2/
* http://localhost:8000/docs/api

As an intended side-effect you should be able to execute testing through the Swagger documentation examples.

### Docker

If you want to bypass the `NPM` install, just start up [Docker](https://docs.docker.com/engine/installation/), the
image can be found here [cdcabrera/swagger-mock-api/](https://hub.docker.com/r/cdcabrera/swagger-mock-api/).

From a terminal prompt:

```shell
$ docker pull cdcabrera/swagger-mock-api
$ docker run -i --rm -p 8000:8000 --name mock-api -t cdcabrera/swagger-mock-api
```

That should serve up the internal Swagger.yaml file. To run your own file:

```shell
$ docker run -i --rm -p 8000:8000 -v PATH_TO/YOUR_FILE.yaml:/data/swagger.yaml --name mock-api -t cdcabrera/swagger-mock-api
```

## Original: Using the middleware

Assuming the API is to be run from a `grunt` task, ensure the following module has also been installed via npm:

* grunt-contrib-connect

If you're not auto-loading grunt tasks, find in your Gruntfile where the tasks are being loaded and add the line:

`grunt.loadNpmTasks('grunt-contrib-connect');`

Then, configure a task like so:

```javascript
const path = require('path');
const mockApi = require('swagger-mock-api');

module.exports = function(grunt) {
  grunt.initConfig({
    connect: {
      server: {
        options: {
          keepalive: true,
          middleware: [
            mockApi({
              swaggerFile: path.join(
                __dirname,
                'path to swagger YAML or JSON file'
              ),
              watch: true // enable reloading the routes and schemas when the swagger file changes
            })
          ]
        }
      }
    }
  });

  grunt.loadNpmTasks('grunt-contrib-connect');

  grunt.registerTask('default', ['connect']);
};
```

### Ignoring specific paths

There are two mutually exlusive options: `ignorePaths` and `mockPaths`; the former specifies which paths to ignore, while the latter specifies the only paths that should be mocked. Depending on what state of completion the backend API is in, you may want to start with ignorePaths (adding as the API improves) and eventually switch over to `mockPaths` and remove until the API is complete.

```javascript
// ....
mockApi({
  swaggerFiles: 'path-to-file',

  ignorePaths: [
    'PUT DELETE /pets/{id}', // you can ignore specific methods of a path
    '/pets/{id}' // or ignore EVERY method for a path
  ]
});
```

## Original: Specifying custom Chance options

Swagger specifies only a few primitive types; for scenarios where specific chance methods are needed, use the `x-chance-type` field.

```yaml
...
definitions:
  NewPet:
    properties:
      name:
        type: string
        x-chance-type: name
      tag:
        type: string
        x-chance-type: guid
```

Most of the chance methods allow some fine-tuning of the returned data. For example, the [integer](http://chancejs.com/#integer) method allows specification of minimum and maximum output values. These options can be configured in the Swagger YAML file with the `x-chance-options` block:

```yaml
...
definitions:
  Pet:
    allOf:
      - $ref: '#/definitions/NewPet'
      - required:
        - id
        properties:
          id:
            type: integer
            format: int64
            x-type-options:
              min: 1
              max: 1000
```

## Original: A note on types:

All of the primitive types defined in the [Swagger specification](https://github.com/swagger-api/swagger-spec/blob/master/versions/2.0.md#data-types) are supported except for `file` and `password`. Currently, the `format` property is ignored; use `x-chance-type` instead. The server will error on any request with a type other than one of the primitive types if there is no valid x-chance-type also defined.

### Returning Fixed Values

Although not a chance method, support has been added for returning fixed values using `x-chance-type: fixed`. Any value given for the custom tag `x-type-value` will be returned; below is an example where an object is returned:

```yaml
    status:
      type: object
      x-chance-type: fixed
      x-type-value:
        type: 'adopted'
```

## Credit

The container work was based off of mrVanDalo's https://github.com/mrVanDalo/swagger-api-mock-docker
